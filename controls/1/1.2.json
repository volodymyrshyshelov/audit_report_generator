[
  {
    "id": "1.2.1",
    "level": "L2",
    "title": "Ensure that only organizationally managed/approved public groups exist",
    "type": "Automated",
    "profile_applicability": "E3 Level 2",
    "description": "Microsoft 365 Groups is the foundational membership service that drives all teamwork across Microsoft 365. With Microsoft 365 Groups, you can give a group of people access to a collection of shared resources. While there are several different group types this recommendation concerns Microsoft 365 Groups.\n\nIn the Administration panel, when a group is created, the default privacy value is \"Public\".",
    "rationale": "Ensure that only organizationally managed and approved public groups exist. When a group has a \"public\" privacy, users may access data related to this group (e.g. SharePoint), through three methods:\n\n• By using the Azure portal, and adding themselves into the public group\n• By requesting access to the group from the Group application of the Access Panel\n• By accessing the SharePoint URL\n\nAdministrators are notified when a user uses the Azure Portal. Requesting access to the group forces users to send a message to the group owner, but they still have immediate access to the group. The SharePoint URL is usually guessable and can be found from the Group application of the Access Panel. If group privacy is not controlled, any user may access sensitive information, according to the group they try to access.\n\nNote: Public in this case means public to the identities within the organization.",
    "impact": "If the recommendation is applied, group owners could receive more access requests than usual, especially regarding groups originally meant to be public.",
    "output": "<output from PowerShell script here>",
    "remediation": "To remediate using the UI:\n\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com.\n2. Click to expand Teams & groups select Active teams & groups..\n3. On the Active teams and groups page, select the group's name that is public.\n4. On the popup groups name page, Select Settings.\n5. Under Privacy, select Private.",
    "audit_ui": "1. Navigate to Microsoft 365 admin center https://admin.microsoft.com.\n2. Click to expand Teams & groups select Active teams & groups.\n3. On the Active teams and groups page, check that no groups have the status 'Public' in the privacy column.",
    "audit_powershell": "Connect to the Microsoft Graph service using Connect-MgGraph -Scopes \"Group.Read.All\"\n\nGet-MgGroup | where {$_.Visibility -eq \"Public\"} | select DisplayName,Visibility\n\nEnsure Visibility is Private for each group.",
    "references": [
      "https://learn.microsoft.com/en-us/entra/identity/users/groups-self-service-management",
      "https://learn.microsoft.com/en-us/microsoft-365/admin/create-groups/compare-groups?view=o365-worldwide"
    ]
  },
  {
    "id": "1.2.2",
    "level": "L1",
    "title": "Ensure sign-in to shared mailboxes is blocked",
    "type": "Automated",
    "profile_applicability": "E3 Level 1",
    "description": "Shared mailboxes are used when multiple people need access to the same mailbox, such as a company information or support email address, reception desk, or other function that might be shared by multiple people.\n\nUsers with permissions to the group mailbox can send as or send on behalf of the mailbox email address if the administrator has given that user permissions to do that. This is particularly useful for help and support mailboxes because users can send emails from \"Contoso Support\" or \"Building A Reception Desk.\"\n\nShared mailboxes are created with a corresponding user account using a system generated password that is unknown at the time of creation.\n\nThe recommended state is Sign in blocked for Shared mailboxes.",
    "rationale": "The intent of the shared mailbox is the only allow delegated access from other mailboxes. An admin could reset the password, or an attacker could potentially gain access to the shared mailbox allowing the direct sign-in to the shared mailbox and subsequently the sending of email from a sender that does not have a unique identity. To prevent this, block sign-in for the account that is associated with the shared mailbox.",
    "impact": "Normal delegated access remains; direct sign-in blocked.",
    "output": "<output from PowerShell script here>",
    "remediation": "To remediate using the UI:\n\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com/\n2. Click to expand Teams & groups and select Shared mailboxes.\n3. Take note of all shared mailboxes.\n4. Click to expand Users and select Active users.\n5. Select a shared mailbox account to open it's properties pane and then select Block sign-in.\n6. Check the box for Block this user from signing in.\n7. Repeat for any additional shared mailboxes.\n\nTo remediate using PowerShell:\n\n1. Connect to Microsoft Graph using Connect-MgGraph -Scopes \"User.ReadWrite.All\"\n2. Connect to Exchange Online using Connect-ExchangeOnline.\n3. To disable sign-in for a single account:\n$MBX = Get-EXOMailbox -Identity TestUser@example.com\nUpdate-MgUser -UserId $MBX.ExternalDirectoryObjectId -AccountEnabled:$false\n4. The following will block sign-in to all Shared Mailboxes:\n$MBX = Get-EXOMailbox -RecipientTypeDetails SharedMailbox\n$MBX | ForEach-Object { Update-MgUser -UserId $_.ExternalDirectoryObjectId -AccountEnabled:$false }",
    "audit_ui": "1. Navigate to Microsoft 365 admin center https://admin.microsoft.com/\n2. Click to expand Teams & groups and select Shared mailboxes.\n3. Take note of all shared mailboxes.\n4. Click to expand Users and select Active users.\n5. Select a shared mailbox account to open its properties pane, and review.\n6. Ensure the text under the name reads Sign-in blocked.\n7. Repeat for any additional shared mailboxes.",
    "audit_powershell": "1. Connect to Exchange Online using Connect-ExchangeOnline\n2. Connect to Microsoft Graph using Connect-MgGraph -Scopes \"Policy.Read.All\"\n3. Run the following PowerShell commands:\n\n$MBX = Get-EXOMailbox -RecipientTypeDetails SharedMailbox\n$MBX | ForEach-Object { Get-MgUser -UserId $_.ExternalDirectoryObjectId -Property DisplayName, UserPrincipalName, AccountEnabled } | Format-Table DisplayName, UserPrincipalName, AccountEnabled\n\nEnsure AccountEnabled is set to False for all Shared Mailboxes.",
    "references": [
      "https://learn.microsoft.com/en-us/microsoft-365/admin/email/about-shared-mailboxes?view=o365-worldwide",
      "https://learn.microsoft.com/en-us/microsoft-365/admin/email/create-a-shared-mailbox?view=o365-worldwide#block-sign-in-for-the-shared-mailbox-account",
      "https://learn.microsoft.com/en-us/microsoft-365/enterprise/block-user-accounts-with-microsoft-365-powershell?view=o365-worldwide#block-individual-user-accounts"
    ]
  }
]
